{% extends "base.html" %}
{% block content %}
<h2>Painel Administrativo</h2>

<p>
  <a href="{{ url_for('index') }}" class="btn">Voltar</a>
  <a href="{{ url_for('admin_export') }}" class="btn" style="margin-left:10px;">Exportar CSV - Questão por linha</a>
  <a href="{{ url_for('admin_export_wide') }}" class="btn" style="margin-left:10px;">Exportar CSV - Paciente por linha</a>
</p>

{% for item in dataset %}
  <section style="border:1px solid #ccc; padding:10px; margin-bottom:18px;">
    <h3>Paciente #{{ item.patient.id }} — {{ item.patient.patient_name }}</h3>
    <p>
      <strong>Medicamento:</strong> {{ item.patient.medication }} &nbsp; | &nbsp;
      <strong>Doença:</strong> {{ item.patient.disease }} &nbsp; | &nbsp;
      <strong>Profissional:</strong> {{ item.patient.professional_name }}
    </p>

    <p>
      <strong>Soma total:</strong> {{ item.stats.total_score }} &nbsp;
      <strong>Barreiras:</strong> {{ item.stats.total_barreiras }} &nbsp;
      <strong>Facilitadores:</strong> {{ item.stats.total_facilitadores }}
    </p>

    <table border="1" cellpadding="6" cellspacing="0" style="width:100%; border-collapse:collapse;">
      <thead style="background:#f0f0f0;">
        <tr>
          <th style="width:6%;">Q</th>
          <th style="width:44%;">Pergunta</th>
          <th style="width:12%;">Alternativa</th>
          <th style="width:6%;">Valor</th>
          <th style="width:20%;">Texto Aberto</th>
          <th style="width:12%;">Barreira / Facilitador</th>
        </tr>
      </thead>
      <tbody>
        {% for r in item.respostas %}
        <tr>
          <td style="text-align:center;">{{ r.question_id }}</td>
          <td>{{ r.question_text }}</td>
          <td>
            {{ r.alternativa }}
            {% if r.alternativa_label %} — {{ r.alternativa_label }}{% endif %}
          </td>
          <td style="text-align:center;">{{ r.valor }}</td>
          <td>{{ r.open_text }}</td>
          <td style="text-align:center;">
            {% if r.is_barreira %}Barreira{% elif r.is_facilitador %}Facilitador{% else %}&nbsp;{% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endfor %}

{% endblock %}
